<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shop</title>
<script defer>
    // var scene = window.buildScene(document.getElementById('mesh-one'));

    // var model = window.buildModelFluvial();
    // model.onReady.addCallback(() => {
    //     scene.addModel(model);
    // });

    var shopWrap = document.getElementById('shop-wrap');
    if (!shopWrap) {
        throw new Error('shop-wrap not found');
    }

    socket.on('shop-size', (sizeObject) => {
        if (!(presenterAuth?.isFollowingPresenter() ?? true)) {
            // Not following presenter, so ignore the message.
            return;
        }
        shopWrap.style.width = sizeObject.width + 'px';
        shopWrap.style.height = sizeObject.height + 'px';
    });

    presenterAuth.addBecomePresenterCallback(broadcastShopState);
    presenterAuth.addStartFollowingCallback(requestPresenterShopState);

    var resizeObserver = new ResizeObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.target != shopWrap) {
                // Nothing to do.
                return;
            }
            const { width, height } = entry.contentRect;

            if (presenterAuth?.isPresenterLocal() ?? false) {
                socket.emit('shop-size-set', { width, height });
            }
        });
    });
    resizeObserver.observe(shopWrap);

    if (presenterAuth?.isFollowingPresenter() ?? false) {
        // As we've just arrived on the page, and are following, ask for state.
        requestPresenterShopState();
    }

    // When leaving this page, tidy up.
    document.tidyPage = () => {
        socket.off('shop-size');
        presenterAuth.removeBecomePresenterCallback(broadcastShopState);

        resizeObserver.disconnect();

        // scene.dispose();
    };

    function broadcastShopState() {
        if (!shopWrap) {
            return;
        }
        const { width, height } = shopWrap.getBoundingClientRect();
        socket.emit('shop-size-set', { width, height });
    }

    function requestPresenterShopState() {
        socket.emit('shop-size-get');
    }

</script>
</head>
<body>
<style>
#shop-wrap {
    background: #eeeeee;
    min-width: 350px;
    min-height: 350px;
    resize: both;
    overflow: auto;
    box-shadow: 0px 0px 13px 2px #0500343b;
}
</style>
    <h1>Shop Mockup</h1>

    <div id="shop-wrap">

    </div>



    <!-- <div id="mesh-one" style="max-width:840px;height:700px;"></div> -->
</body>
</html>